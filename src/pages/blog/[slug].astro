---
import Layout from '../../layouts/Layout.astro'
import BlogPost from '../../components/BlogPost.tsx'
import { getPostBySlug } from '../../lib/kv'
import { marked } from 'marked'
export const prerender = false
const post = await getPostBySlug(Astro.params.slug!)
if (!post) {
  throw new Response(null, { status: 404 })
}
const html = await marked.parse(post.content)

// SEO data
const seoTitle = `${post.title} | PWRUP`
const seoDescription = post.description || post.content.substring(0, 160).replace(/[#*]/g, '').trim() + '...'
const seoImage = post.headerImage?.url || undefined
const seoAuthor = post.author.name
const seoPublishedAt = post.publishedAt
const seoTags = post.tags
---
<Layout
  title={seoTitle}
  description={seoDescription}
  image={seoImage}
  author={seoAuthor}
  publishedAt={seoPublishedAt}
  tags={seoTags}
>
  <BlogPost post={post} content={html} client:load />
</Layout>
