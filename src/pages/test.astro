---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <form id="editor" onsubmit="return savePost(event)" class="space-y-4">
    <input type="file" id="file" />
    <textarea id="content" placeholder="Write something..."></textarea>
    <button type="submit">Save</button>
  </form>
  <script>
    async function savePost(e) {
      e.preventDefault();
      const fileInput = document.getElementById('file');
      const file = fileInput.files[0];
      let imageUrl = null;
      if (file) {
        const res = await fetch(`/api/upload?filename=${encodeURIComponent(file.name)}`);
        const data = await res.json();
        await fetch(data.uploadUrl, { method: 'PUT', body: file });
        imageUrl = data.publicUrl;
      }
      console.log('Saving post with image', imageUrl);
    }
  </script>
</Layout>
